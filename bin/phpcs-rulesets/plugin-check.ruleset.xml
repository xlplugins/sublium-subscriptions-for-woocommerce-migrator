<?xml version="1.0"?>
<ruleset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         name="PluginCheckCore"
         xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/squizlabs/PHP_CodeSniffer/master/phpcs.xsd">

    <description>Core Plugin Check Standards</description>

    <!-- Database Security -->
    <rule ref="WordPress.DB.PreparedSQL"/>
    <rule ref="WordPress.DB.PreparedSQL.InterpolatedNotPrepared">
        <type>warning</type>
    </rule>
	<rule ref="WordPress.DB.DirectDatabaseQuery">
		<type>warning</type>
	</rule>
	<rule ref="WordPress.DB.DirectDatabaseQuery.NoCaching">
		<type>warning</type>
	</rule>
	<rule ref="WordPress.DB.DirectDatabaseQuery.DirectQuery">
		<type>warning</type>
	</rule>
	<rule ref="WordPress.DB.PreparedSQL.NotPrepared">
		<type>warning</type>
	</rule>
	<rule ref="WordPress.DB.PreparedSQLPlaceholders.UnfinishedPrepare">
		<type>warning</type>
	</rule>
    <rule ref="WordPress.DB.PreparedSQLPlaceholders"/>

    <!-- Security -->
    <rule ref="WordPress.Security.NonceVerification">
        <type>warning</type>
    </rule>
    <rule ref="WordPress.Security.ValidatedSanitizedInput">
        <type>warning</type>
    </rule>

    <!-- Prohibited PHP constructs -->
    <rule ref="Generic.PHP.BacktickOperator">
        <severity>7</severity>
    </rule>
    <rule ref="Squiz.PHP.Heredoc">
        <severity>7</severity>
    </rule>
    <rule ref="Generic.PHP.DiscourageGoto.Found">
        <type>error</type>
        <severity>7</severity>
        <message>The "goto" language construct should not be used.</message>
    </rule>

    <!-- Development functions -->
    <rule ref="WordPress.PHP.DevelopmentFunctions">
        <type>warning</type>
    </rule>

    <!-- PHP tags -->
    <rule ref="Generic.PHP.DisallowShortOpenTag"/>
    <rule ref="Generic.PHP.DisallowShortOpenTag.Found">
        <severity>7</severity>
    </rule>
    <rule ref="Generic.PHP.DisallowShortOpenTag.EchoFound">
        <severity>7</severity>
    </rule>
    <rule ref="Generic.PHP.DisallowAlternativePHPTags">
        <severity>7</severity>
    </rule>

    <!-- Prevent path disclosure when using add_theme_page() -->
    <rule ref="WordPress.Security.PluginMenuSlug">
        <severity>6</severity>
    </rule>

    <!-- Database restrictions -->
    <rule ref="WordPress.DB.RestrictedClasses">
        <severity>7</severity>
    </rule>
    <rule ref="WordPress.DB.RestrictedFunctions">
        <severity>7</severity>
    </rule>

    <!-- WordPress alternatives -->
    <rule ref="WordPress.WP.AlternativeFunctions">
        <type>error</type>
        <exclude name="WordPress.WP.AlternativeFunctions.json_encode_json_encode"/>
        <exclude name="WordPress.WP.AlternativeFunctions.file_get_contents_file_get_contents"/>
        <exclude name="WordPress.WP.AlternativeFunctions.file_system_operations_file_put_contents"/>
    </rule>

    <!-- Forbidden functions -->
    <rule ref="Generic.PHP.ForbiddenFunctions">
        <properties>
            <property name="forbiddenFunctions" type="array">
                <element key="move_uploaded_file" value="null"/>
                <element key="passthru" value="null"/>
                <element key="proc_open" value="null"/>
                <element key="create_function" value="null"/>
                <element key="eval" value="null"/>
                <element key="str_rot13" value="null"/>
            </property>
        </properties>
        <type>error</type>
        <severity>7</severity>
    </rule>

    <rule ref="Squiz.PHP.DiscouragedFunctions">
        <properties>
            <property name="forbiddenFunctions" type="array">
                <element key="set_time_limit" value="null"/>
                <element key="ini_set" value="null"/>
                <element key="ini_alter" value="null"/>
                <element key="dl" value="null"/>
            </property>
        </properties>
    </rule>

    <!-- Deprecated WordPress functions -->
    <rule ref="WordPress.WP.DeprecatedClasses"/>
    <rule ref="WordPress.WP.DeprecatedFunctions"/>
    <rule ref="WordPress.WP.DeprecatedParameters"/>
    <rule ref="WordPress.DateTime.RestrictedFunctions"/>

    <!-- Discouraged constants and functions -->
    <rule ref="WordPress.WP.DiscouragedConstants">
        <type>error</type>
        <severity>7</severity>
    </rule>
    <rule ref="WordPress.WP.DiscouragedFunctions">
        <severity>6</severity>
    </rule>

    <!-- Check for usage of deprecated parameter values in WP functions -->
    <rule ref="WordPress.WP.DeprecatedParameterValues">
        <severity>7</severity>
    </rule>

    <!-- File encoding -->
    <rule ref="Generic.Files.ByteOrderMark">
        <severity>7</severity>
    </rule>

    <!-- Note: Custom PluginCheck sniffs removed as they don't exist in our implementation -->

</ruleset>
